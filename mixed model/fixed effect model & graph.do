
cd "/Users/chenchen/Desktop/Volunerability/data"



merge m:1 fips using "/Users/chenchen/Desktop/level2 data.dta"


areg rt intra inter, a(fips)
est store fm1

areg rt intra inter c.intra#i.cpvi_type_x c.inter#i.cpvi_type_x, a(fips)
est store fm2

contrast r.cpvi_type_x#c.intra
contrast rb2.cpvi_type_x#c.intra
contrast rb3.cpvi_type_x#c.intra
contrast rb4.cpvi_type_x#c.intra
contrast rb5.cpvi_type_x#c.intra

contrast r.cpvi_type_x#c.inter
contrast rb2.cpvi_type_x#c.inter
contrast rb3.cpvi_type_x#c.inter
contrast rb4.cpvi_type_x#c.inter
contrast rb5.cpvi_type_x#c.inter

xtset fips date_step

xtreg rt intra inter if cpvi_type_x ==1, fe
margins, at(intra= (0 (0.5) 2))
marginsplot, recast(line) recastci(rarea)
graph save Graph "/Users/chenchen/Dropbox/2021/Volunerability/data/op1.gph",replace
xtreg rt intra inter if cpvi_type_x ==2, fe
margins, at(intra= (0 (0.5) 2))
marginsplot, recast(line) recastci(rarea)
graph save Graph "/Users/chenchen/Dropbox/2021/Volunerability/data/op2.gph",replace
xtreg rt intra inter if cpvi_type_x ==3, fe
margins, at(intra= (0 (0.5) 2))
marginsplot, recast(line) recastci(rarea)
graph save Graph "/Users/chenchen/Dropbox/2021/Volunerability/data/op3.gph",replace
xtreg rt intra inter if cpvi_type_x ==4, fe
margins, at(intra= (0 (0.5) 2))
marginsplot, recast(line) recastci(rarea)
graph save Graph "/Users/chenchen/Dropbox/2021/Volunerability/data/op4.gph", replace
xtreg rt intra inter if cpvi_type_x ==5, fe
margins, at(intra= (0 (0.5) 2))
marginsplot, recast(line) recastci(rarea)
graph save Graph "/Users/chenchen/Dropbox/2021/Volunerability/data/op5.gph",replace

			  
			  
			  
xtreg rt intra inter if cpvi_type_x ==1, fe
margins, at(inter= (0 (0.5) 2))
marginsplot, recast(line) recastci(rarea)
graph save Graph "/Users/chenchen/Dropbox/2021/Volunerability/data/inter_p1.gph", replace
xtreg rt intra inter if cpvi_type_x ==2, fe
margins, at(inter= (0 (0.5) 2))
marginsplot, recast(line) recastci(rarea)
graph save Graph "/Users/chenchen/Dropbox/2021/Volunerability/data/inter_p2.gph", replace
xtreg rt intra inter if cpvi_type_x ==3, fe
margins, at(inter= (0 (0.5) 2))
marginsplot, recast(line) recastci(rarea)
graph save Graph "/Users/chenchen/Dropbox/2021/Volunerability/data/inter_p3.gph", replace
xtreg rt intra inter if cpvi_type_x ==4, fe
margins, at(inter= (0 (0.5) 2))
marginsplot, recast(line) recastci(rarea)
graph save Graph "/Users/chenchen/Dropbox/2021/Volunerability/data/inter_p4.gph", replace
xtreg rt intra inter if cpvi_type_x ==5, fe
margins, at(inter= (0 (0.5) 2))
marginsplot, recast(line) recastci(rarea)
graph save Graph "/Users/chenchen/Dropbox/2021/Volunerability/data/inter_p5.gph", replace
graph combine "/Users/chenchen/Dropbox/2021/Volunerability/data/op1.gph"    ///
              "/Users/chenchen/Dropbox/2021/Volunerability/data/op2.gph"    ///
			  "/Users/chenchen/Dropbox/2021/Volunerability/data/op3.gph"    ///
			  "/Users/chenchen/Dropbox/2021/Volunerability/data/op4.gph"    ///
			  "/Users/chenchen/Dropbox/2021/Volunerability/data/op5.gph"    ///
			  "/Users/chenchen/Dropbox/2021/Volunerability/data/inter_p1.gph"   ///
              "/Users/chenchen/Dropbox/2021/Volunerability/data/inter_p2.gph"   ///
			  "/Users/chenchen/Dropbox/2021/Volunerability/data/inter_p3.gph"   ///
			  "/Users/chenchen/Dropbox/2021/Volunerability/data/inter_p4.gph"   ///
			  "/Users/chenchen/Dropbox/2021/Volunerability/data/inter_p5.gph"
			  
			  





xtreg rt intra inter i.date_step if cpvi_type_x ==1, fe
margins, at(intra= (0 (0.5) 2))
marginsplot, recast(line) recastci(rarea)
graph save Graph "/Users/chenchen/Dropbox/2021/Volunerability/data/fop1.gph",replace
xtreg rt intra inter i.date_step if cpvi_type_x ==2, fe
margins, at(intra= (0 (0.5) 2))
marginsplot, recast(line) recastci(rarea)
graph save Graph "/Users/chenchen/Dropbox/2021/Volunerability/data/fop2.gph",replace
xtreg rt intra inter  i.date_step if cpvi_type_x ==3, fe
margins, at(intra= (0 (0.5) 2))
marginsplot, recast(line) recastci(rarea)
graph save Graph "/Users/chenchen/Dropbox/2021/Volunerability/data/fop3.gph",replace
xtreg rt intra inter i.date_step if cpvi_type_x ==4, fe
margins, at(intra= (0 (0.5) 2))
marginsplot, recast(line) recastci(rarea)
graph save Graph "/Users/chenchen/Dropbox/2021/Volunerability/data/fop4.gph", replace
xtreg rt intra inter i.date_step if cpvi_type_x ==5, fe
margins, at(intra= (0 (0.5) 2))
marginsplot, recast(line) recastci(rarea)
graph save Graph "/Users/chenchen/Dropbox/2021/Volunerability/data/fop5.gph",replace

			  
			  
			  
xtreg rt intra inter i.date_step if cpvi_type_x ==1, fe
margins, at(inter= (0 (0.5) 2))
marginsplot, recast(line) recastci(rarea)
graph save Graph "/Users/chenchen/Dropbox/2021/Volunerability/data/inter_fp1.gph", replace
xtreg rt intra inter i.date_step if cpvi_type_x ==2, fe
margins, at(inter= (0 (0.5) 2))
marginsplot, recast(line) recastci(rarea)
graph save Graph "/Users/chenchen/Dropbox/2021/Volunerability/data/inter_fp2.gph", replace
xtreg rt intra inter i.date_step if cpvi_type_x ==3, fe
margins, at(inter= (0 (0.5) 2))
marginsplot, recast(line) recastci(rarea)
graph save Graph "/Users/chenchen/Dropbox/2021/Volunerability/data/inter_fp3.gph", replace
xtreg rt intra inter i.date_step if cpvi_type_x ==4, fe
margins, at(inter= (0 (0.5) 2))
marginsplot, recast(line) recastci(rarea)
graph save Graph "/Users/chenchen/Dropbox/2021/Volunerability/data/inter_fp4.gph", replace
xtreg rt intra inter i.date_step if cpvi_type_x ==5, fe
margins, at(inter= (0 (0.5) 2))
marginsplot, recast(line) recastci(rarea)
graph save Graph "/Users/chenchen/Dropbox/2021/Volunerability/data/inter_fp5.gph", replace
graph combine "/Users/chenchen/Dropbox/2021/Volunerability/data/fop1.gph"    ///
              "/Users/chenchen/Dropbox/2021/Volunerability/data/fop2.gph"    ///
			  "/Users/chenchen/Dropbox/2021/Volunerability/data/fop3.gph"    ///
			  "/Users/chenchen/Dropbox/2021/Volunerability/data/fop4.gph"    ///
			  "/Users/chenchen/Dropbox/2021/Volunerability/data/fop5.gph"    ///
			  "/Users/chenchen/Dropbox/2021/Volunerability/data/inter_fp1.gph"   ///
              "/Users/chenchen/Dropbox/2021/Volunerability/data/inter_fp2.gph"   ///
			  "/Users/chenchen/Dropbox/2021/Volunerability/data/inter_fp3.gph"   ///
			  "/Users/chenchen/Dropbox/2021/Volunerability/data/inter_fp4.gph"   ///
			  "/Users/chenchen/Dropbox/2021/Volunerability/data/inter_fp5.gph"
			  
			  
sort fips date_step
bysort fips: gen n=_n
gen inter_n=.
gen intra_n=.

replace inter_n=inter[_n-5] if n>=6 & fips==fips[_n-1] 
replace intra_n=intra[_n-5] if n>=6 & fips==fips[_n-1]
 

xtreg rt intra_n inter_n if cpvi_type_x ==1, fe
margins, at(intra_n= (0 (0.5) 2))
marginsplot, recast(line) recastci(rarea)
graph save Graph "/Users/chenchen/Dropbox/2021/Volunerability/data/inter_flagp1.gph", replace

xtreg rt intra_n inter_n if cpvi_type_x ==2, fe
margins, at(intra_n= (0 (0.5) 2))
marginsplot, recast(line) recastci(rarea)
graph save Graph "/Users/chenchen/Dropbox/2021/Volunerability/data/inter_flagp2.gph", replace

xtreg rt intra_n inter_n if cpvi_type_x ==3, fe
margins, at(intra_n= (0 (0.5) 2))
marginsplot, recast(line) recastci(rarea)
graph save Graph "/Users/chenchen/Dropbox/2021/Volunerability/data/inter_flagp3.gph", replace

xtreg rt intra_n inter_n if cpvi_type_x ==4, fe
margins, at(intra_n= (0 (0.5) 2))
marginsplot, recast(line) recastci(rarea)
graph save Graph "/Users/chenchen/Dropbox/2021/Volunerability/data/inter_flagp4.gph", replace

xtreg rt intra_n inter_n if cpvi_type_x ==5, fe
margins, at(intra_n= (0 (0.5) 2))
marginsplot, recast(line) recastci(rarea)
graph save Graph "/Users/chenchen/Dropbox/2021/Volunerability/data/inter_flagp5.gph", replace

xtreg rt intra_n inter_n if cpvi_type_x ==1, fe
margins, at(inter_n= (0 (0.5) 2))
marginsplot, recast(line) recastci(rarea)
graph save Graph "/Users/chenchen/Dropbox/2021/Volunerability/data/inter_flagq1.gph", replace

xtreg rt intra_n inter_n if cpvi_type_x ==2, fe
margins, at(inter_n= (0 (0.5) 2))
marginsplot, recast(line) recastci(rarea)
graph save Graph "/Users/chenchen/Dropbox/2021/Volunerability/data/inter_flagq2.gph", replace

xtreg rt intra_n inter_n if cpvi_type_x ==3, fe
margins, at(inter_n= (0 (0.5) 2))
marginsplot, recast(line) recastci(rarea)
graph save Graph "/Users/chenchen/Dropbox/2021/Volunerability/data/inter_flagq3.gph", replace

xtreg rt intra_n inter_n if cpvi_type_x ==4, fe
margins, at(inter_n= (0 (0.5) 2))
marginsplot, recast(line) recastci(rarea)
graph save Graph "/Users/chenchen/Dropbox/2021/Volunerability/data/inter_flagq4.gph", replace

xtreg rt intra_n inter_n if cpvi_type_x ==5, fe
margins, at(inter_n= (0 (0.5) 2))
marginsplot, recast(line) recastci(rarea)
graph save Graph "/Users/chenchen/Dropbox/2021/Volunerability/data/inter_flagq5.gph", replace

graph combine "/Users/chenchen/Dropbox/2021/Volunerability/data/inter_flagp1.gph" ///
              "/Users/chenchen/Dropbox/2021/Volunerability/data/inter_flagp2.gph" ///
			  "/Users/chenchen/Dropbox/2021/Volunerability/data/inter_flagp3.gph" ///
			  "/Users/chenchen/Dropbox/2021/Volunerability/data/inter_flagp4.gph" ///
			  "/Users/chenchen/Dropbox/2021/Volunerability/data/inter_flagp5.gph" ///
			  "/Users/chenchen/Dropbox/2021/Volunerability/data/inter_flagq1.gph" ///
			  "/Users/chenchen/Dropbox/2021/Volunerability/data/inter_flagq2.gph" ///
			  "/Users/chenchen/Dropbox/2021/Volunerability/data/inter_flagq3.gph" ///
			  "/Users/chenchen/Dropbox/2021/Volunerability/data/inter_flagq4.gph" ///
			  "/Users/chenchen/Dropbox/2021/Volunerability/data/inter_flagq5.gph"








