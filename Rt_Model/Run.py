from data_smoothed import *
from model import *
import pandas as pd
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
plt.style.use('seaborn-darkgrid')

def run(New_cases):
    """
    Runs the full data gathering, processing and moddeling pipeline
    """

    # Get smoothed data
    original, smoothed = smooth_cases(New_cases)

    # Plot orginal vs smoothed
    # plots.original_smoothed(original, smoothed)

    # Get posteriors from optimized Bayesian model
    posterior = bayesian_model(smoothed, p=0.95, save_posteriors_df=True,
                                     optimize=True)

    # Plot Rt estimate
    # plots.plot_rt(posterior)


if __name__ == "__main__":
    data = pd.read_csv('F:\\Vulnerability\\更新\\新冠\\covid_confirmed_usafacts.csv', index_col='Fips')
    data = data.loc[:, '2020/5/28': '2020/9/1'].T
    Rt_county = pd.DataFrame(data.index)
    Rt_county.columns = ['Date']
    Rt_county.index = Rt_county['Date']
    original, smoothed = smooth_cases(los)
    Rt = bayesian_model(smoothed, p=0.95, save_posteriors_df=True, optimize=True)